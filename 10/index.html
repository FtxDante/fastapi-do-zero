
<!doctype html>
<html lang="pt" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Nossa aplicação um passo mais próximo do deploy">
      
      
      
        <link rel="canonical" href="https://fastapidozero.dunossauro.com/10/">
      
      
        <link rel="prev" href="../09/">
      
      
        <link rel="next" href="../11/">
      
      
      <link rel="icon" href="../assets/logo.svg">
      <meta name="generator" content="mkdocs-1.6.0, mkdocs-material-9.5.26">
    
    
      
        <title>Dockerizando a nossa aplicação e introduzindo o PostgreSQL - FastAPI do Zero</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.6543a935.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../stylesheets/extra.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
      
        <meta  property="og:type"  content="website" >
      
        <meta  property="og:title"  content="Dockerizando a nossa aplicação e introduzindo o PostgreSQL - FastAPI do Zero" >
      
        <meta  property="og:description"  content="Nossa aplicação um passo mais próximo do deploy" >
      
        <meta  property="og:image"  content="https://fastapidozero.dunossauro.com/assets/images/social/10.png" >
      
        <meta  property="og:image:type"  content="image/png" >
      
        <meta  property="og:image:width"  content="1200" >
      
        <meta  property="og:image:height"  content="630" >
      
        <meta  property="og:url"  content="https://fastapidozero.dunossauro.com/10/" >
      
        <meta  name="twitter:card"  content="summary_large_image" >
      
        <meta  name="twitter:title"  content="Dockerizando a nossa aplicação e introduzindo o PostgreSQL - FastAPI do Zero" >
      
        <meta  name="twitter:description"  content="Nossa aplicação um passo mais próximo do deploy" >
      
        <meta  name="twitter:image"  content="https://fastapidozero.dunossauro.com/assets/images/social/10.png" >
      
    
    
   <link href="../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>
    html.glightbox-open { overflow: initial; height: 100%; }
    .gslide-title { margin-top: 0px; user-select: text; }
    .gslide-desc { color: #666; user-select: text; }
    .gslide-image img { background: white; }
    .gscrollbar-fixer { padding-right: 15px; }
    .gdesc-inner { font-size: 0.75rem; }
    body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
    body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
    body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}</style> <script src="../assets/javascripts/glightbox.min.js"></script></head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="deep-purple" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Cabeçalho">
    <a href=".." title="FastAPI do Zero" class="md-header__button md-logo" aria-label="FastAPI do Zero" data-md-component="logo">
      
  <img src="../assets/logo.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            FastAPI do Zero
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Dockerizando a nossa aplicação e introduzindo o PostgreSQL
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="deep-purple" data-md-color-accent="indigo"  aria-label="Modo claro"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Modo claro" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5c-.84 0-1.65.15-2.39.42L12 2M3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29L3.34 7m.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14L3.36 17M20.65 7l-1.77 3.79a7.023 7.023 0 0 0-2.38-4.15l4.15.36m-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29L20.64 17M12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44L12 22Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="deep-purple" data-md-color-accent="indigo"  aria-label="Modo noturno"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Modo noturno" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3 3.19.09m3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95 2.06.05m-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31Z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Buscar" placeholder="Buscar" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Pesquisar">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="Compartilhar" aria-label="Compartilhar" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Limpar" aria-label="Limpar" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Inicializando busca
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/dunossauro/fastapi-do-zero" title="Ir para repositório" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    dunossauro/fastapi-do-zero
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navegação" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="FastAPI do Zero" class="md-nav__button md-logo" aria-label="FastAPI do Zero" data-md-component="logo">
      
  <img src="../assets/logo.svg" alt="logo">

    </a>
    FastAPI do Zero
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/dunossauro/fastapi-do-zero" title="Ir para repositório" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    dunossauro/fastapi-do-zero
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    FastAPI do Zero!
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../01/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Configurando o ambiente de desenvolvimento
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../02/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Introdução ao desenvolvimento WEB
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../03/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Estruturando o Projeto e Criando Rotas CRUD
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../04/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Configurando o banco de dados e gerenciando migrações com Alembic
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../05/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Integrando Banco de Dados a API
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../06/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Autenticação e Autorização com JWT
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../07/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Refatorando a Estrutura do Projeto
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../08/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Tornando o sistema de autenticação robusto
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../09/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Criando Rotas CRUD para Gerenciamento de Tarefas em FastAPI
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Dockerizando a nossa aplicação e introduzindo o PostgreSQL
  </span>
  

      </a>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../11/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Automatizando os testes com Integração Contínua
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../12/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Fazendo deploy no Fly.io
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../13/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Despedida e próximos passos
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../14/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Projeto final
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_16" >
        
          
          <label class="md-nav__link" for="__nav_16" id="__nav_16_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Aulas
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_16_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_16">
            <span class="md-nav__icon md-icon"></span>
            Aulas
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../aulas/sincronas/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Aulas síncronas
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_17" >
        
          
          <label class="md-nav__link" for="__nav_17" id="__nav_17_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Projetos
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_17_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_17">
            <span class="md-nav__icon md-icon"></span>
            Projetos
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../projetos/projetos_finais/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Projetos finais
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../projetos/repositorios/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Repositórios do curso
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_18" >
        
          
          <label class="md-nav__link" for="__nav_18" id="__nav_18_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Quizes
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_18_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_18">
            <span class="md-nav__icon md-icon"></span>
            Quizes
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../quizes/aula_01/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    01 - Configurando o Ambiente de Desenvolvimento
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../quizes/aula_02/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    02 - Introdução ao desenvolvimento WEB
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../quizes/aula_03/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    03 - Estruturando o Projeto e Criando Rotas CRUD
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../quizes/aula_04/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    04 - Configurando o Banco de Dados e Gerenciando Migrações com Alembic
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../quizes/aula_05/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    05 - Integrando Banco de Dados a API
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../quizes/aula_06/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    06 - Autenticação e Autorização com JWT
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../quizes/aula_07/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    07 - Refatorando a Estrutura do Projeto
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../quizes/aula_08/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    08 - Tornando o sistema de autenticação robusto
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../quizes/aula_09/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    09 - Criando Rotas CRUD para Gerenciamento de Tarefas em FastAPI
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../quizes/aula_10/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    10 - Dockerizando a nossa aplicação e introduzindo o PostgreSQL
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../quizes/aula_11/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    11 - Automatizando os testes com Integração Contínua (CI)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../quizes/aula_12/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    12 - Fazendo deploy no Fly.io
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Índice">
  
  
  
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<div><h1>Dockerizando a nossa aplicação e introduzindo o PostgreSQL</h1>
<hr>
<p>Objetivos da aula:</p>
<ul>
<li>Compreender os conceitos básicos do Docker</li>
<li>Entender como criar uma imagem Docker para a nossa aplicação FastAPI</li>
<li>Aprender a rodar a aplicação utilizando Docker</li>
<li>Introduzir o conceito de Docker Compose para gerenciamento de múltiplos contêineres</li>
<li>Aprender o que é um Dockerfile e sua estrutura</li>
<li>Entender os benefícios e motivos da mudança de SQLite para PostgreSQL</li>
</ul>
<p>??? tip "Caso prefira ver a aula em vídeo"
    Esse aula ainda não está disponível em formato de vídeo, somente em texto!
    <a class="glightbox" href="https://www.youtube.com/embed/u31qwQUeGuM" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><div class="video-container"><iframe src="https://www.youtube.com/embed/u31qwQUeGuM" style="position:relative;width:100%;height:22.172vw" frameborder="0" allowfullscreen alt="type:video"></iframe></div></a></p>
<p><a href="#">Aula :fontawesome-brands-youtube:</a>{ .md-button }
<a href="https://github.com/dunossauro/fastapi-do-zero/blob/main/slides/pdf/aula_10.pdf">Slides :fontawesome-solid-file-powerpoint:</a>{ .md-button }
<a href="https://github.com/dunossauro/fastapi-do-zero/tree/main/codigo_das_aulas/10">Código :fontawesome-solid-code:</a>{ .md-button }
<a href="quizes/aula_10.md">Quiz :material-comment-question:</a>{ .md-button }</p>
<hr>
<p>Após a implementação do nosso gerenciador de tarefas na aula anterior, temos uma primeira versão estável da nossa aplicação. Nesta aula, além de aprendermos a "dockerizar" nossa aplicação FastAPI, também abordaremos a migração do banco de dados SQLite para o PostgreSQL.</p>
<h2>O Docker e a nossa aplicação</h2>
<p><a href="https://www.docker.com/">Docker</a>{:target="_blank"} é uma plataforma aberta que permite automatizar o processo de implantação, escalonamento e operação de aplicações dentro de contêineres. Ele serve para "empacotar" uma aplicação e suas dependências em um contêiner virtual que pode ser executado em qualquer sistema operacional que suporte Docker. Isso facilita a implantação, o desenvolvimento e o compartilhamento de aplicações, além de proporcionar um ambiente isolado e consistente.</p>
<p>??? warning "Caso não tenha o docker instalado na sua máquina"
    A instalação do Docker varia entre sistemas operacionais. Por esse motivo, acredito que não cabe cobrir a instalação do docker nesse material.</p>
<pre><code>=== "Windows"
    A instalação no windows varia com a forma em que você administra o seu sistema. Ela pode se basear em WSL2 ou no Hyper-V.

    Os passos para ambos os tipos de instalação podem ser encontrados na documentação oficial do docker: [link](https://docs.docker.com/desktop/install/windows-install/){:target="_blank"}.

=== "Linux"
    A instalação no linux variará de acordo com a sua distribuição. As distribuições mais tradicionais (baseadas em Debian e RHEL podem ser encontradas na documentação oficial do docker: [link](https://docs.docker.com/desktop/install/linux-install/){:target="_blank"}.

    Outras distribuições devem ter o pacote do docker disponível em seus repositórios. Como distro baseadas em [Archlinux](https://wiki.archlinux.org/title/Docker){:target="_blank"}.

=== "MacOS X"
    A instalação no MacOS, dependerá da arquitetura do seu computador. Se você usa Intel ou Silicon.

    Os passos para ambos os tipos de instalação podem ser encontrados na documentação oficial do docker: [link](https://docs.docker.com/desktop/install/mac-install/){:target="_blank"}.
</code></pre>
<h3>Criando nosso Dockerfile</h3>
<p>Para criar um container Docker, escrevemos uma lista de passos de como construir o ambiente para execução da nossa aplicação em um arquivo chamado <code>Dockerfile</code>. Ele define o ambiente de execução, os comandos necessários para preparar o ambiente e o comando a ser executado quando um contêiner é iniciado a partir da imagem.</p>
<p>Uma das coisas interessantes sobre Docker é que existe um <a href="https://hub.docker.com/">Hub de containers</a>{:target="_blank"} prontos onde a comunidade hospeda imagens "prontas", que podemos usar como ponto de partida. Por exemplo, a comunidade de python mantém um grupo de imagens com o <a href="https://hub.docker.com/_/python">ambiente python</a>{:target="_blank"} pronto para uso. Podemos partir dessa imagem com o python já instalado adicionar os passos para que nossa aplicação seja executada.</p>
<p>Aqui está um exemplo de <code>Dockerfile</code> para executar nossa aplicação:</p>
<p>=== "Versão 3.11"</p>
<pre><code>```docker
FROM python:3.11-slim
ENV POETRY_VIRTUALENVS_CREATE=false

WORKDIR app/
COPY . .

RUN pip install poetry

RUN poetry config installer.max-workers 10
RUN poetry install --no-interaction --no-ansi

EXPOSE 8000
CMD poetry run uvicorn --host 0.0.0.0 fast_zero.app:app
<div class="language-text highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>Aqui está o que cada linha faz:
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>1. `FROM python:3.11-slim`: define a imagem base para nosso contêiner. Estamos usando a versão slim da imagem do Python 3.11, que tem tudo que precisamos para rodar nossa aplicação.
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>2. `ENV POETRY_VIRTUALENVS_CREATE=false`: define uma variável de ambiente que diz ao Poetry para não criar um ambiente virtual. (O container já é um ambiente isolado)
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>3. `RUN pip install poetry`: instala o Poetry, nosso gerenciador de pacotes.
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>4. `WORKDIR app/`: define o diretório em que executaremos os comandos a seguir.
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a>5. `COPY . .`: copia todos os arquivos do diretório atual para o contêiner.
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a>6. `RUN poetry config installer.max-workers 10`: configura o Poetry para usar até 10 workers ao instalar pacotes.
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a>7. `RUN poetry install --no-interaction --no-ansi`: instala as dependências do nosso projeto sem interação e sem cores no output.
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a>8. `EXPOSE 8000`: informa ao Docker que o contêiner escutará na porta 8000.
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a>9. `CMD poetry run uvicorn --host 0.0.0.0 fast_zero.app:app`: define o comando que será executado quando o contêiner for iniciado.
</span><span id="__span-0-12"><a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a>&lt;/code&gt;&lt;/pre&gt;
</span><span id="__span-0-13"><a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a>&lt;p&gt;=== "Versão 3.12"&lt;/p&gt;
</span><span id="__span-0-14"><a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a>&lt;pre&gt;&lt;code&gt;```docker
</span><span id="__span-0-15"><a id="__codelineno-0-15" name="__codelineno-0-15" href="#__codelineno-0-15"></a>FROM python:3.12-slim
</span><span id="__span-0-16"><a id="__codelineno-0-16" name="__codelineno-0-16" href="#__codelineno-0-16"></a>ENV POETRY_VIRTUALENVS_CREATE=false
</span><span id="__span-0-17"><a id="__codelineno-0-17" name="__codelineno-0-17" href="#__codelineno-0-17"></a>
</span><span id="__span-0-18"><a id="__codelineno-0-18" name="__codelineno-0-18" href="#__codelineno-0-18"></a>WORKDIR app/
</span><span id="__span-0-19"><a id="__codelineno-0-19" name="__codelineno-0-19" href="#__codelineno-0-19"></a>COPY . .
</span><span id="__span-0-20"><a id="__codelineno-0-20" name="__codelineno-0-20" href="#__codelineno-0-20"></a>
</span><span id="__span-0-21"><a id="__codelineno-0-21" name="__codelineno-0-21" href="#__codelineno-0-21"></a>RUN pip install poetry
</span><span id="__span-0-22"><a id="__codelineno-0-22" name="__codelineno-0-22" href="#__codelineno-0-22"></a>
</span><span id="__span-0-23"><a id="__codelineno-0-23" name="__codelineno-0-23" href="#__codelineno-0-23"></a>RUN poetry config installer.max-workers 10
</span><span id="__span-0-24"><a id="__codelineno-0-24" name="__codelineno-0-24" href="#__codelineno-0-24"></a>RUN poetry install --no-interaction --no-ansi
</span><span id="__span-0-25"><a id="__codelineno-0-25" name="__codelineno-0-25" href="#__codelineno-0-25"></a>
</span><span id="__span-0-26"><a id="__codelineno-0-26" name="__codelineno-0-26" href="#__codelineno-0-26"></a>EXPOSE 8000
</span><span id="__span-0-27"><a id="__codelineno-0-27" name="__codelineno-0-27" href="#__codelineno-0-27"></a>CMD poetry run uvicorn --host 0.0.0.0 fast_zero.app:app
</span></code></pre></div>

Aqui está o que cada linha faz:

1. `FROM python:3.12-slim`: define a imagem base para nosso contêiner. Estamos usando a versão slim da imagem do Python 3.12, que tem tudo que precisamos para rodar nossa aplicação.
2. `ENV POETRY_VIRTUALENVS_CREATE=false`: define uma variável de ambiente que diz ao Poetry para não criar um ambiente virtual. (O container já é um ambiente isolado)
3. `RUN pip install poetry`: instala o Poetry, nosso gerenciador de pacotes.
4. `WORKDIR app/`: define o diretório em que executaremos os comandos a seguir.
5. `COPY . .`: copia todos os arquivos do diretório atual para o contêiner.
6. `RUN poetry config installer.max-workers 10`: configura o Poetry para usar até 10 workers ao instalar pacotes.
7. `RUN poetry install --no-interaction --no-ansi`: instala as dependências do nosso projeto sem interação e sem cores no output.
8. `EXPOSE 8000`: informa ao Docker que o contêiner escutará na porta 8000.
9. `CMD poetry run uvicorn --host 0.0.0.0 fast_zero.app:app`: define o comando que será executado quando o contêiner for iniciado.
</code></pre>
<p>Vamos entender melhor esse último comando:</p>
<ul>
<li><code>poetry run</code> define o comando que será executado no ambiente virtual criado pelo Poetry.</li>
<li><code>uvicorn</code> é o servidor ASGI que usamos para rodar nossa aplicação.</li>
<li><code>--host</code> define o host que o servidor escutará. Especificamente, <code>"0.0.0.0"</code> é um endereço IP que permite que o servidor aceite conexões de qualquer endereço de rede disponível, tornando-o acessível externamente.</li>
<li><code>fast_zero.app:app</code> define o <code>&lt;módulo python&gt;:&lt;objeto&gt;</code> que o servidor executará.</li>
</ul>
<h3>Criando a imagem</h3>
<p>Para criar uma imagem Docker a partir do Dockerfile, usamos o comando <code>docker build</code>. O comando a seguir cria uma imagem chamada "fast_zero":</p>
<div class="highlight"><span class="filename">$ Execução no terminal!</span><pre><span></span><code>docker<span class="w"> </span>build<span class="w"> </span>-t<span class="w"> </span><span class="s2">"fast_zero"</span><span class="w"> </span>.
</code></pre></div>
<p>??? warning "Você usa Mac com Silicon?"
    Pode haver alguma incompatibilidade em alguma biblioteca durante o build. Pois nem todos os pacotes estão disponíveis para Silicon no <a href="https://pypi.org/">pypi</a>{:target="_blank"}. Arquitetura <code>aarch64</code>.</p>
<pre><code>Caso encontre algum problema, durante o build você pode especificar a plataforma para `amd64`. Que é a arquitetura em que o curso foi escrito:

<div class="language-shell highlight"><span class="filename">$ Execução no terminal!</span><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>docker<span class="w"> </span>build<span class="w"> </span>--platform<span class="w"> </span>linux/amd64<span class="w"> </span>-t<span class="w"> </span><span class="s2">"fast_zero"</span><span class="w"> </span>.
</span></code></pre></div>

Mais informações nessa [issue](https://github.com/dunossauro/fastapi-do-zero/issues/147){:target="_blank"}. Obrigado [@K-dash](https://github.com/K-dash){:target="_blank"} por notificar :heart:
</code></pre>
<p>Este comando lê o Dockerfile no diretório atual (indicado pelo <code>.</code>) e cria uma imagem com a tag "fast_zero", (indicada pelo <code>-t</code>).</p>
<p>Então verificaremos se a imagem foi criada com sucesso usando o comando:</p>
<div class="highlight"><span class="filename">$ Execução no terminal!</span><pre><span></span><code>docker<span class="w"> </span>images
</code></pre></div>
<p>Este comando lista todas as imagens Docker disponíveis no seu sistema.</p>
<h3>Executando o container</h3>
<p>Para executar o contêiner, usamos o comando <code>docker run</code>. Especificamos o nome do contêiner com a flag <code>--name</code>, indicamos a imagem que queremos executar e a tag que queremos usar <code>&lt;nome_da_imagem&gt;:&lt;tag&gt;</code>. A flag <code>-p</code> serve para mapear a porta do host para a porta do contêiner <code>&lt;porta_do_host&gt;:&lt;porta_do_contêiner&gt;</code>. Portanto, teremos o seguinte comando:</p>
<div class="highlight"><span class="filename">$ Execução no terminal!</span><pre><span></span><code>docker<span class="w"> </span>run<span class="w"> </span>-it<span class="w"> </span>--name<span class="w"> </span>fastzeroapp<span class="w"> </span>-p<span class="w"> </span><span class="m">8000</span>:8000<span class="w"> </span>fast_zero:latest
</code></pre></div>
<p>Este comando iniciará nossa aplicação em um contêiner Docker, que estará escutando na porta 8000. Para testar se tudo está funcionando corretamente, você pode acessar <code>http://localhost:8000</code> em um navegador ou usar um comando como:</p>
<div class="highlight"><span class="filename">$ Execução no terminal!</span><pre><span></span><code>curl<span class="w"> </span>http://localhost:8000
</code></pre></div>
<p>???+ danger "Caso você fique preso no terminal"</p>
<pre><code>Caso você tenha a aplicação travada no terminal e não consiga sair, você pode teclar ++ctrl+"C"++ para parar a execução do container.
</code></pre>
<h3>Gerenciando Containers docker</h3>
<p>Quando você trabalha com Docker, é importante saber como gerenciar os contêineres. Aqui estão algumas operações básicas para gerenciá-los:</p>
<ol>
<li>
<p><strong>Rodar um contêiner em background</strong>: se você deseja executar o contêiner em segundo plano para que não ocupe o terminal, pode usar a opção <code>-d</code>:</p>
<div class="highlight"><span class="filename">$ Execução no terminal!</span><pre><span></span><code>docker<span class="w"> </span>run<span class="w"> </span>-d<span class="w"> </span>--name<span class="w"> </span>fastzeroapp<span class="w"> </span>-p<span class="w"> </span><span class="m">8000</span>:8000<span class="w"> </span>fast_zero:latest
</code></pre></div>
</li>
<li>
<p><strong>Parar um contêiner</strong>: quando você "para" um contêiner, está essencialmente interrompendo a execução do processo principal do contêiner. Isso significa que o contêiner não está mais ativo, mas ainda existe no sistema, com seus dados associados e configuração. Isso permite que você reinicie o contêiner posteriormente, se desejar.</p>
<div class="highlight"><span class="filename">$ Execução no terminal!</span><pre><span></span><code>docker<span class="w"> </span>stop<span class="w"> </span>fastzeroapp
</code></pre></div>
</li>
<li>
<p><strong>Remover um contêiner</strong>: ao "remover" um contêiner, você está excluindo o contêiner do sistema. Isso significa que todos os dados associados ao contêiner são apagados. Uma vez que um contêiner é removido, você não pode reiniciá-lo; no entanto, você pode sempre criar um novo contêiner a partir da mesma imagem.</p>
<div class="highlight"><span class="filename">$ Execução no terminal!</span><pre><span></span><code>docker<span class="w"> </span>rm<span class="w"> </span>fastzeroapp
</code></pre></div>
</li>
</ol>
<p>Ambos os comandos (stop e rm) usam o nome do contêiner que definimos anteriormente com a flag <code>--name</code>. É uma boa prática manter a gestão dos seus contêineres, principalmente durante o desenvolvimento, para evitar um uso excessivo de recursos ou conflitos de nomes e portas.</p>
<h2>Introduzindo o postgreSQL</h2>
<p>O <a href="https://www.postgresql.org/">PostgreSQL</a> é um Sistema de Gerenciamento de Banco de Dados Objeto-Relacional (ORDBMS) poderoso e de código aberto. Ele é amplamente utilizado em produção em muitos projetos devido à sua robustez, escalabilidade e conjunto de recursos extensos.</p>
<p>Mudar para um banco de dados como PostgreSQL tem vários benefícios:</p>
<ul>
<li><strong>Escalabilidade</strong>: SQLite não é ideal para aplicações em larga escala ou com grande volume de dados. PostgreSQL foi projetado para lidar com uma grande quantidade de dados e requisições.</li>
<li><strong>Concorrência</strong>: diferentemente do SQLite, que tem limitações para gravações simultâneas, o PostgreSQL suporta múltiplas operações simultâneas.</li>
<li><strong>Funcionalidades avançadas</strong>: PostgreSQL vem com várias extensões e funcionalidades que o SQLite pode não oferecer.</li>
</ul>
<p>Além disso, SQLite tem algumas limitações que podem torná-lo inadequado para produção em alguns casos. Por exemplo, ele não suporta alta concorrência e pode ter problemas de performance com grandes volumes de dados.</p>
<p>!!! note "Nota"
    Embora para o escopo da nossa aplicação e os objetivos de aprendizado o SQLite pudesse ser suficiente, é sempre bom nos prepararmos para cenários de produção real. A adoção de PostgreSQL nos dá uma prévia das práticas do mundo real e garante que nossa aplicação possa escalar sem grandes modificações de infraestrutura.</p>
<h3>Como executar o postgres?</h3>
<p>Embora o PostgreSQL seja poderoso, sua instalação direta em uma máquina real pode ser desafiadora e pode resultar em configurações diferentes entre os ambientes de desenvolvimento. Felizmente, podemos utilizar o Docker para resolver esse problema. No Docker Hub, estão disponíveis imagens pré-construídas do PostgreSQL, permitindo-nos executar o PostgreSQL com um único comando. Confira a <a href="https://hub.docker.com/_/postgres">imagem oficial do PostgreSQL</a>.</p>
<p>Para executar um contêiner do PostgreSQL, use o seguinte comando:</p>
<div class="highlight"><span class="filename">$ Execução no terminal!</span><pre><span></span><code>docker<span class="w"> </span>run<span class="w"> </span>-d<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--name<span class="w"> </span>app_database<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-e<span class="w"> </span><span class="nv">POSTGRES_USER</span><span class="o">=</span>app_user<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-e<span class="w"> </span><span class="nv">POSTGRES_DB</span><span class="o">=</span>app_db<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-e<span class="w"> </span><span class="nv">POSTGRES_PASSWORD</span><span class="o">=</span>app_password<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-p<span class="w"> </span><span class="m">5432</span>:5432<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>postgres
</code></pre></div>
<h4>Explicando as Flags e Configurações</h4>
<ul>
<li><strong>Flag <code>-e</code></strong>:</li>
</ul>
<p>Esta flag é usada para definir variáveis de ambiente no contêiner. No contexto do PostgreSQL, essas variáveis são essenciais. Elas configuram o nome de usuário, nome do banco de dados, e senha durante a primeira execução do contêiner. Sem elas, o PostgreSQL pode não iniciar da forma esperada. É uma forma prática de configurar o PostgreSQL sem interagir manualmente ou criar arquivos de configuração.</p>
<ul>
<li><strong>Porta <code>5432</code></strong>:</li>
</ul>
<p>O PostgreSQL, por padrão, escuta por conexões na porta <code>5432</code>. Mapeando esta porta do contêiner para a mesma porta no host (usando <code>-p</code>), fazemos com que o PostgreSQL seja acessível nesta porta na máquina anfitriã, permitindo que outras aplicações se conectem a ele.</p>
<p>!!! warning "Sobre as variáveis"</p>
<pre><code>Os valores acima (`app_user`, `app_db`, e `app_password`) são padrões genéricos para facilitar a inicialização do PostgreSQL em um ambiente de desenvolvimento. No entanto, é altamente recomendável que você altere esses valores, especialmente `app_password`, para garantir a segurança do seu banco de dados.
</code></pre>
<h4>Volumes e Persistência de Dados</h4>
<p>Para garantir a persistência dos dados entre execuções do contêiner, utilizamos volumes. Um volume mapeia um diretório do sistema host para um diretório no contêiner. Isso é crucial para bancos de dados, pois sem um volume, ao remover o contêiner, todos os dados armazenados dentro dele se perderiam.</p>
<p>No PostgreSQL, o diretório padrão para armazenamento de dados é <code>/var/lib/postgresql/data</code>. Mapeamos esse diretório para um volume (neste caso "pgdata") em nossa máquina host para garantir a persistência dos dados:</p>
<div class="highlight"><span class="filename">$ Execução no terminal!</span><pre><span></span><code>docker<span class="w"> </span>run<span class="w"> </span>-d<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--name<span class="w"> </span>app_database<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-e<span class="w"> </span><span class="nv">POSTGRES_USER</span><span class="o">=</span>app_user<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-e<span class="w"> </span><span class="nv">POSTGRES_DB</span><span class="o">=</span>app_db<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-e<span class="w"> </span><span class="nv">POSTGRES_PASSWORD</span><span class="o">=</span>app_password<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-v<span class="w"> </span>pgdata:/var/lib/postgresql/data<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-p<span class="w"> </span><span class="m">5432</span>:5432<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>postgres
</code></pre></div>
<p>O parâmetro do volume é passado ao contêiner usando o parâmetro <code>-v</code> Dessa forma, os dados do banco continuarão existindo, mesmo que o contêiner seja reiniciado ou removido.</p>
<h3>Adicionando o suporte ao PostgreSQL na nossa aplicação</h3>
<p>Para que o SQLAlchemy suporte o PostgreSQL, precisamos instalar uma dependência chamada <code>psycopg</code>. Este é o adaptador PostgreSQL para Python e é crucial para fazer a comunicação.</p>
<p>Para instalar essa dependência, utilize o seguinte comando:</p>
<div class="highlight"><span class="filename">$ Execução no terminal!</span><pre><span></span><code>poetry<span class="w"> </span>add<span class="w"> </span><span class="s2">"psycopg[binary]"</span>
</code></pre></div>
<p>Uma das vantagens do SQLAlchemy enquanto ORM é a flexibilidade. Com apenas algumas alterações mínimas, como a atualização da string de conexão, podemos facilmente transicionar para um banco de dados diferente. Assim, após ajustar o arquivo <code>.env</code> com a string de conexão do PostgreSQL, a aplicação deverá operar normalmente, mas desta vez utilizando o PostgreSQL.</p>
<p>Para ajustar a conexão com o PostgreSQL, modifique seu arquivo <code>.env</code> para incluir a seguinte string de conexão:</p>
<div class="highlight"><span class="filename">.env</span><pre><span></span><code><span class="nv">DATABASE_URL</span><span class="o">=</span><span class="s2">"postgresql+psycopg://app_user:app_password@localhost:5432/app_db"</span>
</code></pre></div>
<p>!!! failure "Caso tenha alterado as variáveis de ambiente do contêiner"</p>
<pre><code>Se você alterou `app_user`, `app_password` ou `app_db` ao inicializar o contêiner PostgreSQL, garanta que esses valores sejam refletidos na string de conexão acima. A palavra `localhost` indica que o banco de dados PostgreSQL está sendo executado na mesma máquina que sua aplicação. Se o banco de dados estiver em uma máquina diferente, substitua `localhost` pelo endereço IP correspondente e, se necessário, ajuste a porta `5432`.
</code></pre>
<p>Para que a instalação do <code>psycopg</code> esteja na imagem docker, precisamos fazer um novo build. Para que a nova versão do <code>pyproject.toml</code> seja copiada e os novos pacotes sejam instalados:</p>
<div class="highlight"><span class="filename">$ Execução no terminal!</span><pre><span></span><code>docker<span class="w"> </span>rm<span class="w"> </span>fastzeroapp<span class="w"> </span><span class="c1">#(1)!</span>
docker<span class="w"> </span>build<span class="w"> </span>-t<span class="w"> </span><span class="s2">"fast_zero"</span><span class="w"> </span><span class="c1">#(2)!</span>
docker<span class="w"> </span>run<span class="w"> </span>-it<span class="w"> </span>--name<span class="w"> </span>fastzeroapp<span class="w"> </span>-p<span class="w"> </span><span class="m">8000</span>:8000<span class="w"> </span>fast_zero:latest<span class="w"> </span><span class="c1">#(3)!</span>
</code></pre></div>
<ol>
<li>Remove a versão antiga</li>
<li>Refaz o build</li>
<li>Executa novamente</li>
</ol>
<h3>Executando as migrações</h3>
<p>Migrações são como versões para seu banco de dados, permitindo que você atualize sua estrutura de forma ordenada e controlada. Sempre que mudamos de banco de dados, ou até mesmo quando alteramos sua estrutura, as migrações precisam ser executadas para garantir que a base de dados esteja em sincronia com nosso código.</p>
<p>No contexto de contêineres, rodar as migrações se torna ainda mais simples. Quando mudamos de banco de dados, como é o caso de termos saído de um SQLite (por exemplo) para um PostgreSQL, as migrações são essenciais. O motivo é simples: o novo banco de dados não terá a estrutura e os dados do antigo, a menos que migremos. As migrações irão garantir que o novo banco de dados tenha a mesma estrutura e relações que o anterior.</p>
<p>??? warning "Antes de executar o próximo comando"
    Assegure-se de que ambos os contêineres, tanto da aplicação quanto do banco de dados, estejam ativos. O contêiner do banco de dados deve estar rodando para que a aplicação possa se conectar a ele.</p>
<pre><code>Assegure-se de que o contêiner da aplicação esteja ativo. Estamos usando a flag `--network=host` para que o contêiner use a rede do host. Isso pode ser essencial para evitar problemas de conexão, já que não podemos prever como está configurada a rede do computador onde este comando será executado.

<div class="language-bash highlight"><span class="filename">execução no terminal</span><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>docker<span class="w"> </span>run<span class="w"> </span>-d<span class="w"> </span>--network<span class="o">=</span>host<span class="w"> </span>--name<span class="w"> </span>fastzeroapp<span class="w"> </span>-p<span class="w"> </span><span class="m">8000</span>:8000<span class="w"> </span>fast_zero:latest
</span></code></pre></div>
</code></pre>
<p>Para aplicar migrações em um ambiente com contêineres, frequentemente temos comandos específicos associados ao serviço. Vejamos como executar migrações usando o Docker:</p>
<div class="highlight"><span class="filename">$ Execução no terminal!</span><pre><span></span><code>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-it<span class="w"> </span>fastzeroapp<span class="w"> </span>poetry<span class="w"> </span>run<span class="w"> </span>alembic<span class="w"> </span>upgrade<span class="w"> </span>head
</code></pre></div>
<p>O comando <code>docker exec</code> é usado para invocar um comando específico dentro de um contêiner em execução. A opção <code>-it</code> é uma combinação de <code>-i</code> (interativo) e <code>-t</code> (pseudo-TTY), que juntas garantem um terminal interativo, permitindo a comunicação direta com o contêiner.</p>
<p>Após executar as migrações, você pode verificar a criação das tabelas utilizando um sistema de gerenciamento de banco de dados. A seguir, apresentamos um exemplo com o Beekeeper Studio:</p>
<p><a class="glightbox" href="assets/10/beekeeper_postgres.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Tabelas do PostgreSQL no Beekeeper Studio" src="assets/10/beekeeper_postgres.png"></a></p>
<p><strong>Lembre-se</strong>: Embora as tabelas estejam agora criadas e estruturadas, o banco de dados ainda não contém os dados anteriormente presentes no SQLite ou em qualquer outro banco que você estivesse utilizando antes.</p>
<h2>Simplificando nosso fluxo com <code>docker-compose</code></h2>
<p>Docker Compose é uma ferramenta que permite definir e gerenciar aplicativos multi-contêiner com Docker. <strong>É como se você tivesse um maestro conduzindo uma orquestra: o maestro (ou Docker Compose) garante que todos os músicos (ou contêineres) toquem em harmonia.</strong> Definimos nossa aplicação e serviços relacionados, como o PostgreSQL, em um arquivo <code>compose.yaml</code> e os gerenciamos juntos através de comandos simplificados.</p>
<p>Ao adotar o Docker Compose, facilitamos o desenvolvimento e a execução da nossa aplicação com seus serviços dependentes utilizando um único comando.</p>
<h3>Criação do <code>compose.yaml</code></h3>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">compose.yaml</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nt">services</span><span class="p">:</span>
<span class="w">  </span><span class="nt">fastzero_database</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">postgres</span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pgdata:/var/lib/postgresql/data</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="nt">POSTGRES_USER</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app_user</span>
<span class="w">      </span><span class="nt">POSTGRES_DB</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app_db</span>
<span class="w">      </span><span class="nt">POSTGRES_PASSWORD</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app_password</span>
<span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">"5432:5432"</span>

<span class="w">  </span><span class="nt">fastzero_app</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">fastzero_app</span>
<span class="w">    </span><span class="nt">build</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">.</span>
<span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">"8000:8000"</span>
<span class="w">    </span><span class="nt">depends_on</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">fastzero_database</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="nt">DATABASE_URL</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">postgresql+psycopg://app_user:app_password@fastzero_database:5432/app_db</span>

<span class="nt">volumes</span><span class="p">:</span>
<span class="w">  </span><span class="nt">pgdata</span><span class="p">:</span>
</code></pre></div></td></tr></table></div>
<p><strong>Explicação linha a linha:</strong></p>
<ol>
<li>
<p><code>services:</code>: define os serviços (contêineres) que serão gerenciados.</p>
</li>
<li>
<p><code>fastzero_database:</code>: define nosso serviço de banco de dados PostgreSQL.</p>
</li>
<li>
<p><code>image: postgres</code>: usa a imagem oficial do PostgreSQL.</p>
</li>
<li>
<p><code>volumes:</code>: mapeia volumes para persistência de dados.</p>
</li>
<li>
<p><code>pgdata:/var/lib/postgresql/data</code>: cria ou usa um volume chamado "pgdata" e o mapeia para o diretório <code>/var/lib/postgresql/data</code> no contêiner.</p>
</li>
<li>
<p><code>environment:</code>: define variáveis de ambiente para o serviço.</p>
</li>
<li>
<p><code>fastzero_app:</code>: define o serviço para nossa aplicação.</p>
</li>
<li>
<p><code>image: fastzero_app</code>: usa a imagem Docker da nossa aplicação.</p>
</li>
<li>
<p><code>build:</code>: instruções para construir a imagem se não estiver disponível, procura pelo <code>Dockerfile</code> em <code>.</code>.</p>
</li>
<li>
<p><code>ports:</code>: mapeia portas do contêiner para o host.</p>
</li>
<li>
<p><code>"8000:8000"</code>: mapeia a porta 8000 do contêiner para a porta 8000 do host.</p>
</li>
<li>
<p><code>depends_on:</code>: especifica que <code>fastzero_app</code> depende de <code>fastzero_database</code>. Isto garante que o banco de dados seja iniciado antes da aplicação.</p>
</li>
<li>
<p><code>DATABASE_URL: ...</code>: é uma variável de ambiente que nossa aplicação usará para se conectar ao banco de dados. Aqui, ele se conecta ao serviço <code>fastzero_database</code> que definimos anteriormente.</p>
</li>
<li>
<p><code>volumes:</code> (nível superior): define volumes que podem ser usados pelos serviços.</p>
</li>
<li>
<p><code>pgdata:</code>: define um volume chamado "pgdata". Este volume é usado para persistir os dados do PostgreSQL entre as execuções do contêiner.</p>
</li>
</ol>
<p>!!! warning "Sobre o docker-compose"
    Para usar o Docker Compose, você precisa tê-lo instalado em seu sistema. Ele não está incluído na instalação padrão do Docker, então lembre-se de instalá-lo separadamente!</p>
<pre><code>O guia oficial de instalação pode ser encontrado [aqui](https://docs.docker.com/compose/install/standalone/){:target="_blank"}
</code></pre>
<p>Com este arquivo <code>compose.yaml</code>, você pode iniciar ambos os serviços (aplicação e banco de dados) simultaneamente usando:</p>
<div class="highlight"><pre><span></span><code>docker-compose<span class="w"> </span>up
</code></pre></div>
<p>Para parar os serviços e manter os dados seguros nos volumes definidos, use:</p>
<div class="highlight"><pre><span></span><code>docker-compose<span class="w"> </span>down
</code></pre></div>
<p>Esses comandos simplificam o fluxo de trabalho e garantem que os serviços iniciem corretamente e se comuniquem conforme o esperado.</p>
<p>!!! note "Execução em modo desanexado"
    Você pode iniciar os serviços em segundo plano com a flag <code>-d</code> usando <code>docker-compose up -d</code>. Isso permite que os contêineres rodem em segundo plano, liberando o terminal para outras tarefas.</p>
<h3>Rodando as migrações de forma automática</h3>
<p>Automatizar as migrações do banco de dados é uma prática recomendada para garantir que sua aplicação esteja sempre sincronizada com o estado mais atual do seu esquema de banco de dados. É como preparar todos os ingredientes antes de começar a cozinhar: você garante que tudo o que é necessário está pronto para ser usado.</p>
<p>Para automatizar as migrações em nossos contêineres Docker, utilizamos um <code>entrypoint</code>. O <code>entrypoint</code> define o comando que será executado quando o contêiner iniciar. Em outras palavras, é o primeiro ponto de entrada de execução do contêiner.</p>
<p><strong>Por que usar o Entrypoint?</strong></p>
<p>No Docker, o <code>entrypoint</code> permite que você configure um ambiente de contêiner que será executado como um executável. É útil para preparar o ambiente, como realizar migrações de banco de dados, antes de iniciar a aplicação propriamente dita. Isso significa que qualquer comando definido no <code>CMD</code> do Dockerfile não será executado automaticamente se um <code>entrypoint</code> estiver definido. Em vez disso, precisamos incluir explicitamente esse comando no script de <code>entrypoint</code>.</p>
<p><strong>Implementando o Entrypoint</strong></p>
<p>Criamos um script chamado <code>entrypoint.sh</code> que irá preparar nosso ambiente antes de a aplicação iniciar:</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">entrypoin.sh</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="ch">#!/bin/sh</span>

<span class="c1"># Executa as migrações do banco de dados</span>
poetry<span class="w"> </span>run<span class="w"> </span>alembic<span class="w"> </span>upgrade<span class="w"> </span>head

<span class="c1"># Inicia a aplicação</span>
poetry<span class="w"> </span>run<span class="w"> </span>uvicorn<span class="w"> </span>--host<span class="w"> </span><span class="m">0</span>.0.0.0<span class="w"> </span>--port<span class="w"> </span><span class="m">8000</span><span class="w"> </span>fast_zero.app:app
</code></pre></div></td></tr></table></div>
<p><strong>Explicação Detalhada do Script</strong>:</p>
<ul>
<li><code>#!/bin/sh</code>: indica ao sistema operacional que o script deve ser executado no shell Unix.</li>
<li><code>poetry run alembic upgrade head</code>: roda as migrações do banco de dados até a última versão.</li>
<li><code>poetry run uvicorn --host 0.0.0.0 --port 8000 fast_zero.app:app</code>: inicia a aplicação. Este é o comando que normalmente estaria no <code>CMD</code> do Dockerfile, mas agora está incluído no <code>entrypoint</code> para garantir que as migrações sejam executadas antes do servidor iniciar.</li>
</ul>
<p><strong>Como Funciona na Prática?</strong></p>
<p>Quando o contêiner é iniciado, o Docker executa o script de <code>entrypoint</code>, que por sua vez executa as migrações e só então inicia a aplicação. Isso garante que o banco de dados esteja atualizado com as últimas migrações antes de qualquer interação com a aplicação.</p>
<p><strong>Visualizando o Processo</strong>:</p>
<p>Você pode pensar no <code>entrypoint.sh</code> como o ato de aquecer e verificar todos os instrumentos antes de uma apresentação musical. Antes de a música começar, cada instrumento é afinado e testado. Da mesma forma, nosso script assegura que o banco de dados está em harmonia com a aplicação antes de ela começar a receber requisições.</p>
<p><strong>Adicionando o Entrypoint ao Docker Compose</strong>:</p>
<p>Incluímos o <code>entrypoint</code> no nosso serviço no arquivo <code>compose.yaml</code>, garantindo que esteja apontando para o script correto:</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">compose.yaml</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="w">  </span><span class="nt">fastzero_app</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">fastzero_app</span>
<span class="hll"><span class="w">    </span><span class="nt">entrypoint</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./entrypoint.sh</span>
</span><span class="w">    </span><span class="nt">build</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">.</span>
</code></pre></div></td></tr></table></div>
<p><strong>Reconstruindo e Executando com Novas Configurações</strong>:</p>
<p>Para aplicar as alterações, reconstruímos e executamos os serviços com a opção <code>--build</code>:</p>
<div class="highlight"><span class="filename">$ Execução no terminal!</span><pre><span></span><code>docker-compose<span class="w"> </span>up<span class="w"> </span>--build
</code></pre></div>
<p><strong>Observando o Comportamento Esperado</strong>:</p>
<p>Quando o contêiner é iniciado, você deve ver as migrações sendo aplicadas, seguidas pela inicialização da aplicação:</p>
<div class="highlight"><span class="filename">$ Exemplo do resultado no terminal!</span><pre><span></span><code><span class="hll">fastzero_app-1<span class="w">  </span><span class="p">|</span><span class="w"> </span>INFO<span class="w">  </span><span class="o">[</span>alembic.runtime.migration<span class="o">]</span><span class="w"> </span>Context<span class="w"> </span>impl<span class="w"> </span>PostgresqlImpl.
</span><span class="hll">fastzero_app-1<span class="w">  </span><span class="p">|</span><span class="w"> </span>INFO<span class="w">  </span><span class="o">[</span>alembic.runtime.migration<span class="o">]</span><span class="w"> </span>Will<span class="w"> </span>assume<span class="w"> </span>transactional<span class="w"> </span>DDL.
</span>fastzero_app-1<span class="w">  </span><span class="p">|</span><span class="w"> </span>INFO:<span class="w">     </span>Started<span class="w"> </span>server<span class="w"> </span>process<span class="w"> </span><span class="o">[</span><span class="m">10</span><span class="o">]</span>
fastzero_app-1<span class="w">  </span><span class="p">|</span><span class="w"> </span>INFO:<span class="w">     </span>Waiting<span class="w"> </span><span class="k">for</span><span class="w"> </span>application<span class="w"> </span>startup.
fastzero_app-1<span class="w">  </span><span class="p">|</span><span class="w"> </span>INFO:<span class="w">     </span>Application<span class="w"> </span>startup<span class="w"> </span>complete.
<span class="hll">fastzero_app-1<span class="w">  </span><span class="p">|</span><span class="w"> </span>INFO:<span class="w">     </span>Uvicorn<span class="w"> </span>running<span class="w"> </span>on<span class="w"> </span>http://0.0.0.0:8000<span class="w"> </span><span class="o">(</span>Press<span class="w"> </span>CTRL+C<span class="w"> </span>to<span class="w"> </span>quit<span class="o">)</span>
</span></code></pre></div>
<p>Este processo garante que as migrações do banco de dados são realizadas automaticamente, mantendo a base de dados alinhada com a aplicação e pronta para ação assim que o servidor Uvicorn entra em cena.</p>
<hr>
<p>??? info "Nota de revisão sobre variáveis de ambiente"
    Utilizar variáveis de ambiente definidas em um arquivo <code>.env</code> é uma prática recomendada para cenários de produção devido à segurança que oferece. No entanto, para manter a simplicidade e o foco nas funcionalidades do FastAPI neste curso, optamos por explicitar essas variáveis no <code>compose.yaml</code>. Isso é particularmente relevante, pois o Docker Compose é utilizado apenas para o ambiente de desenvolvimento; no deploy para <a href="http://fly.io">fly.io</a>{:target="_blank"}, o qual é o nosso foco, o compose não será utilizado em produção.</p>
<pre><code>Ainda assim, é valioso mencionar como essa configuração mais segura seria realizada, especialmente para aqueles que planejam utilizar o Docker Compose em produção.

---

Em ambientes de produção com Docker Compose, é uma boa prática gerenciar variáveis de ambiente sensíveis, como credenciais, por meio de um arquivo `.env`. Isso previne a exposição dessas informações diretamente no arquivo `compose.yaml`, contribuindo para a segurança do projeto.

As variáveis de ambiente podem ser definidas em nosso arquivo `.env` localizado na raiz do projeto:

<div class="language-text highlight"><span class="filename">.env</span><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>POSTGRES_USER=app_user
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a>POSTGRES_DB=app_db
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a>POSTGRES_PASSWORD=app_password
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a>DATABASE_URL=postgresql://app_user:app_password@fastzero_database:5432/app_db
</span></code></pre></div>

Para aplicar essas variáveis, referencie o arquivo `.env` no `compose.yaml`:

<div class="language-yaml highlight"><span class="filename">compose.yaml</span><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="nt">services</span><span class="p">:</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="w">  </span><span class="nt">fastzero_database</span><span class="p">:</span>
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">postgres</span>
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a><span class="hll"><span class="w">    </span><span class="nt">env_file</span><span class="p">:</span>
</span></span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a><span class="hll"><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">.env</span>
</span></span><span id="__span-4-6"><a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a><span class="w">    </span><span class="c1"># Restante da configuração...</span>
</span><span id="__span-4-7"><a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a>
</span><span id="__span-4-8"><a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a><span class="w">  </span><span class="nt">fastzero_app</span><span class="p">:</span>
</span><span id="__span-4-9"><a id="__codelineno-4-9" name="__codelineno-4-9" href="#__codelineno-4-9"></a><span class="w">    </span><span class="nt">build</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">.</span>
</span><span id="__span-4-10"><a id="__codelineno-4-10" name="__codelineno-4-10" href="#__codelineno-4-10"></a><span class="hll"><span class="w">    </span><span class="nt">env_file</span><span class="p">:</span>
</span></span><span id="__span-4-11"><a id="__codelineno-4-11" name="__codelineno-4-11" href="#__codelineno-4-11"></a><span class="hll"><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">.env</span>
</span></span><span id="__span-4-12"><a id="__codelineno-4-12" name="__codelineno-4-12" href="#__codelineno-4-12"></a><span class="w">    </span><span class="c1"># Restante da configuração...</span>
</span></code></pre></div>

Adotar essa abordagem evita a exposição das variáveis de ambiente no arquivo de configuração. Esta não foi a abordagem padrão no curso devido à complexidade adicional e à intenção de evitar confusões. Dependendo do ambiente estabelecido pela equipe de DevOps/SRE em um projeto real, essa gestão pode variar entre variáveis de ambiente, arquivos `.env` ou soluções mais avançadas como [Vault](https://www.hashicorp.com/products/vault){:target="_blank"}.

Se optar por utilizar um arquivo `.env` com as configurações do PostgreSQL, configure o Pydantic para ignorar variáveis de ambiente que não são necessárias, adicionando `#!py extra='ignore'` a chamada de `SettingsConfigDic`:

<div class="language-py highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">fast_zero/settings.py</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-5-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-5-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-5-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-5-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-5-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-5-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-5-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-5-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-5-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-5-10">10</a></span>
<span class="normal"><a href="#__codelineno-5-11">11</a></span>
<span class="normal"><a href="#__codelineno-5-12">12</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1"></a><span class="kn">from</span> <span class="nn">pydantic_settings</span> <span class="kn">import</span> <span class="n">BaseSettings</span><span class="p">,</span> <span class="n">SettingsConfigDict</span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2"></a>
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3"></a>
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4"></a><span class="k">class</span> <span class="nc">Settings</span><span class="p">(</span><span class="n">BaseSettings</span><span class="p">):</span>
</span><span id="__span-5-5"><a id="__codelineno-5-5" name="__codelineno-5-5"></a>    <span class="n">model_config</span> <span class="o">=</span> <span class="n">SettingsConfigDict</span><span class="p">(</span>
</span><span id="__span-5-6"><a id="__codelineno-5-6" name="__codelineno-5-6"></a>        <span class="n">env_file</span><span class="o">=</span><span class="s1">'.env'</span><span class="p">,</span> <span class="n">env_file_encoding</span><span class="o">=</span><span class="s1">'utf-8'</span><span class="p">,</span> <span class="n">extra</span><span class="o">=</span><span class="s1">'ignore'</span>
</span><span id="__span-5-7"><a id="__codelineno-5-7" name="__codelineno-5-7"></a>    <span class="p">)</span>
</span><span id="__span-5-8"><a id="__codelineno-5-8" name="__codelineno-5-8"></a>
</span><span id="__span-5-9"><a id="__codelineno-5-9" name="__codelineno-5-9"></a>    <span class="n">DATABASE_URL</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="__span-5-10"><a id="__codelineno-5-10" name="__codelineno-5-10"></a>    <span class="n">SECRET_KEY</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="__span-5-11"><a id="__codelineno-5-11" name="__codelineno-5-11"></a>    <span class="n">ALGORITHM</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="__span-5-12"><a id="__codelineno-5-12" name="__codelineno-5-12"></a>    <span class="n">ACCESS_TOKEN_EXPIRE_MINUTES</span><span class="p">:</span> <span class="nb">int</span>
</span></code></pre></div></td></tr></table></div>

Com essa configuração, o Pydantic irá ignorar quaisquer variáveis no `.env` que não sejam explicitamente declaradas na classe `Settings`, evitando assim conflitos e erros inesperados.

&gt;  Agradecimentos especiais a [@vcwild](https://github.com/vcwild){:target="_blank"} e [@williangl](https://github.com/williangl){:target="_blank"} pelas revisões valiosas nesta aula que me fizeram criar essa nota. :heart:
</code></pre>
<p>??? example "Boas práticas de inicialização do banco de dados"
    Como esse é um caso pensado em estudo, possivelmente não haverá problemas relacionados à inicialização. Em um ambiente de produção, porém, não existe a garantia de que o postgres está pronto para uso no momento em que o <code>entrypoint</code> for executado. Seria necessário que, antes da execução da migração, o container do banco de dados tivesse a inicialização finalizada.</p>
<pre><code>Isso é feito usando o campo `healthcheck` do `compose.yaml`:

<div class="language-py highlight"><span class="filename">compose.yaml</span><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="n">services</span><span class="p">:</span>
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a>  <span class="n">fastzero_database</span><span class="p">:</span>
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a>  <span class="n">image</span><span class="p">:</span> <span class="n">postgres</span>
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a>  <span class="n">volumes</span><span class="p">:</span>
</span><span id="__span-6-5"><a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a>    <span class="o">-</span> <span class="n">pgdata</span><span class="p">:</span><span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">postgresql</span><span class="o">/</span><span class="n">data</span>
</span><span id="__span-6-6"><a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a>  <span class="n">environment</span><span class="p">:</span>
</span><span id="__span-6-7"><a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a>      <span class="n">POSTGRES_USER</span><span class="p">:</span> <span class="n">app_user</span>
</span><span id="__span-6-8"><a id="__codelineno-6-8" name="__codelineno-6-8" href="#__codelineno-6-8"></a>      <span class="n">POSTGRES_DB</span><span class="p">:</span> <span class="n">app_db</span>
</span><span id="__span-6-9"><a id="__codelineno-6-9" name="__codelineno-6-9" href="#__codelineno-6-9"></a>      <span class="n">POSTGRES_PASSWORD</span><span class="p">:</span> <span class="n">app_password</span>
</span><span id="__span-6-10"><a id="__codelineno-6-10" name="__codelineno-6-10" href="#__codelineno-6-10"></a>  <span class="n">ports</span><span class="p">:</span>
</span><span id="__span-6-11"><a id="__codelineno-6-11" name="__codelineno-6-11" href="#__codelineno-6-11"></a>      <span class="o">-</span> <span class="s2">"5432:5432"</span>
</span><span id="__span-6-12"><a id="__codelineno-6-12" name="__codelineno-6-12" href="#__codelineno-6-12"></a><span class="hll">  <span class="n">healthcheck</span><span class="p">:</span>
</span></span><span id="__span-6-13"><a id="__codelineno-6-13" name="__codelineno-6-13" href="#__codelineno-6-13"></a><span class="hll">      <span class="n">test</span><span class="p">:</span> <span class="p">[</span><span class="s2">"CMD-SHELL"</span><span class="p">,</span> <span class="s2">"pg_isready"</span><span class="p">]</span>
</span></span><span id="__span-6-14"><a id="__codelineno-6-14" name="__codelineno-6-14" href="#__codelineno-6-14"></a><span class="hll">      <span class="n">interval</span><span class="p">:</span> <span class="mi">5</span><span class="n">s</span>
</span></span><span id="__span-6-15"><a id="__codelineno-6-15" name="__codelineno-6-15" href="#__codelineno-6-15"></a><span class="hll">      <span class="n">timeout</span><span class="p">:</span> <span class="mi">5</span><span class="n">s</span>
</span></span><span id="__span-6-16"><a id="__codelineno-6-16" name="__codelineno-6-16" href="#__codelineno-6-16"></a><span class="hll">      <span class="n">retries</span><span class="p">:</span> <span class="mi">10</span>
</span></span></code></pre></div>

Dessa forma, ele irá executar o comando [`pg_isready`](https://www.postgresql.org/docs/current/app-pg-isready.html){:target="_blank"} a cada 5 segundos por 10 vezes. `pg_isready` é um utilitário do PostgreSQL que verifica se ele já está operando e pronto para receber conexões. Desta forma, a inicialização do container só termina quando o postgres estiver ouvindo conexões.

Dica do [@ayharano](https://github.com/ayharano){:target="_blank"} nessa [issue](https://github.com/dunossauro/fastapi-do-zero/issues/48){:target="_blank"}.
</code></pre>
<h2>Testes e Docker</h2>
<p>Uma das partes importantes dos testes é tentar chegar o mais próximo possível do ambiente de desenvolvimento. Contudo, nessa aula, introduzimos uma dependência que vai além do python, o postgres.</p>
<p>Isso pode tornar o nosso código mais complicado de testar, por existir um <a href="http://xunitpatterns.com/DOC.html">DoC</a>{:target="_blank"}. Um "componente dependente" para ser executado. Nesse caso, porém, é interno ao sqlalchemy. Para usar o <code>psycopg</code>, temos uma dependência externa ao python, o banco de dados precisa estar sendo executado, caso contrário os testes falharão.</p>
<h3>Executando testes com o banco de dados em um container</h3>
<p>Os testes contemplam um ciclo de feedback positivo, eles têm que ser executados de forma rápida e eficiente. Adicionar o container do Postgres a nossa aplicação, torna o processo de testes um pouco mais complexo. Pois existe uma dependência ao nível de sistema para os testes serem executados.</p>
<p>Começaremos começar com o contraexemplo. Vamos alterar o comportamento da fixture do banco de dados para usar o postgres:</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">tests/conftest.py</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="kn">from</span> <span class="nn">fast_zero.app</span> <span class="kn">import</span> <span class="n">app</span>
<span class="kn">from</span> <span class="nn">fast_zero.database</span> <span class="kn">import</span> <span class="n">get_session</span>
<span class="kn">from</span> <span class="nn">fast_zero.models</span> <span class="kn">import</span> <span class="n">table_registry</span>
<span class="hll"><span class="kn">from</span> <span class="nn">fast_zero.settings</span> <span class="kn">import</span> <span class="n">Settings</span>
</span><span class="kn">from</span> <span class="nn">fast_zero.security</span> <span class="kn">import</span> <span class="n">get_password_hash</span>
<span class="kn">from</span> <span class="nn">tests.factories</span> <span class="kn">import</span> <span class="n">UserFactory</span>


<span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">session</span><span class="p">():</span>
<span class="hll">    <span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="n">Settings</span><span class="p">()</span><span class="o">.</span><span class="n">DATABASE_URL</span><span class="p">)</span>
</span>    <span class="n">table_registry</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">create_all</span><span class="p">(</span><span class="n">engine</span><span class="p">)</span>

    <span class="k">with</span> <span class="n">Session</span><span class="p">(</span><span class="n">engine</span><span class="p">)</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
        <span class="k">yield</span> <span class="n">session</span>
        <span class="n">session</span><span class="o">.</span><span class="n">rollback</span><span class="p">()</span>

    <span class="n">table_registry</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">drop_all</span><span class="p">(</span><span class="n">engine</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<p>Com essa modificação, agora estamos apontando para o PostgreSQL, conforme definido nas configurações da nossa aplicação (<code>Settings().DATABASE_URL</code>). A transição do SQLite para o PostgreSQL é facilitada pela abstração fornecida pelo SQLAlchemy, que nos permite mudar de um banco para outro sem problemas.</p>
<blockquote>
<p>É importante notar que essa flexibilidade se deve ao fato de não termos utilizado recursos específicos do PostgreSQL que não são suportados pelo SQLite. Caso contrário, a mudança poderia não ser tão direta.</p>
</blockquote>
<p>Partindo desse exemplo, para os testes serem executados, o banco de dados precisaria estar de pé. O que nos cobraria um container em execução para os testes poderem rodar.</p>
<p>Por exemplo:</p>
<div class="highlight"><span class="filename">$ Execução no terminal!</span><pre><span></span><code>task<span class="w"> </span><span class="nb">test</span>
</code></pre></div>
<p>Isso originaria esse erro:</p>
<div class="highlight"><pre><span></span><code><span class="o">=============================</span><span class="w"> </span><span class="nb">test</span><span class="w"> </span>session<span class="w"> </span><span class="nv">starts</span><span class="w"> </span><span class="o">==============================</span>
platform<span class="w"> </span>linux<span class="w"> </span>--<span class="w"> </span>Python<span class="w"> </span><span class="m">3</span>.12.3,<span class="w"> </span>pytest-8.2.1,<span class="w"> </span>pluggy-1.5.0<span class="w"> </span>--<span class="w"> </span>/home/dunossauro/git/fastapi-do-zero/codigo_das_aulas/10/.venv/bin/python
cachedir:<span class="w"> </span>.pytest_cache
rootdir:<span class="w"> </span>/home/dunossauro/git/fastapi-do-zero/codigo_das_aulas/10
configfile:<span class="w"> </span>pyproject.toml
plugins:<span class="w"> </span>anyio-4.4.0,<span class="w"> </span>cov-5.0.0,<span class="w"> </span>Faker-25.4.0
collecting<span class="w"> </span>...<span class="w"> </span>collected<span class="w"> </span><span class="m">28</span><span class="w"> </span>items

tests/test_app.py::test_root_deve_retornar_ok_e_ola_mundo<span class="w"> </span><span class="nv">ERROR</span>

<span class="o">====================================</span><span class="w"> </span><span class="nv">ERRORS</span><span class="w"> </span><span class="o">====================================</span>
___________<span class="w"> </span>ERROR<span class="w"> </span>at<span class="w"> </span>setup<span class="w"> </span>of<span class="w"> </span>test_root_deve_retornar_ok_e_ola_mundo<span class="w"> </span>___________

<span class="nv">self</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>&lt;sqlalchemy.engine.base.Connection<span class="w"> </span>object<span class="w"> </span>at<span class="w"> </span>0x7ad981fb7380&gt;
<span class="nv">engine</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>Engine<span class="o">(</span>postgresql+psycopg://app_user:***@localhost:5432/app_db<span class="o">)</span>
<span class="nv">connection</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>None,<span class="w"> </span><span class="nv">_has_events</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>None,<span class="w"> </span><span class="nv">_allow_revalidate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>True
<span class="nv">_allow_autobegin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>True

<span class="c1"># ...</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span>not<span class="w"> </span>rv:
<span class="w">            </span>assert<span class="w"> </span>last_ex
&gt;<span class="w">           </span>raise<span class="w"> </span>last_ex.with_traceback<span class="o">(</span>None<span class="o">)</span>
<span class="hll">E<span class="w">           </span>psycopg.OperationalError:<span class="w"> </span>connection<span class="w"> </span>failed:<span class="w"> </span>connection<span class="w"> </span>to<span class="w"> </span>server<span class="w"> </span>at<span class="w"> </span><span class="s2">"127.0.0.1"</span>,<span class="w"> </span>port<span class="w"> </span><span class="m">5432</span><span class="w"> </span>failed:<span class="w"> </span>Connection<span class="w"> </span>refused
</span>E<span class="w">               </span>Is<span class="w"> </span>the<span class="w"> </span>server<span class="w"> </span>running<span class="w"> </span>on<span class="w"> </span>that<span class="w"> </span>host<span class="w"> </span>and<span class="w"> </span>accepting<span class="w"> </span>TCP/IP<span class="w"> </span>connections?

.venv/lib/python3.12/site-packages/psycopg/connection.py:748:<span class="w"> </span>OperationalError
</code></pre></div>
<p>Obtivemos o erro <code>#!python psycopg.OperationalError: connection failed: connection to server at "127.0.0.1", port 5432 failed: Connection refused</code>. Ele diz que ouve uma falha na comunicação com o nosso host na porta <code>5432</code>. O endereço que colocamos no <code>.env</code>. Para que ele fique acessível, temos que iniciar o container antes de executar os testes.</p>
<p>Para isso:</p>
<div class="highlight"><span class="filename">$ Execução no terminal!</span><pre><span></span><code>docker-compose<span class="w"> </span>up<span class="w"> </span>-d<span class="w"> </span>fastzero_database<span class="w"> </span><span class="c1">#(1)!</span>
</code></pre></div>
<ol>
<li>Inicia somente o container no banco de dados via docker compose</li>
</ol>
<p>E em seguida executar os testes:</p>
<div class="highlight"><span class="filename">$ Execução no terminal!</span><pre><span></span><code>task<span class="w"> </span><span class="nb">test</span>
</code></pre></div>
<p>Agora, sucesso. O resultado é exatamente o que esperávamos:</p>
<div class="highlight"><pre><span></span><code>All<span class="w"> </span>checks<span class="w"> </span>passed!
<span class="o">==========</span><span class="w"> </span><span class="nb">test</span><span class="w"> </span>session<span class="w"> </span><span class="nv">starts</span><span class="w"> </span><span class="o">==========</span>
platform<span class="w"> </span>linux<span class="w"> </span>--<span class="w"> </span>Python<span class="w"> </span><span class="m">3</span>.12.3,<span class="w"> </span>pytest-8.2.1,<span class="w"> </span>pluggy-1.5.0<span class="w"> </span>--<span class="w"> </span>/.../10/.venv/bin/python
cachedir:<span class="w"> </span>.pytest_cache
rootdir:<span class="w"> </span>/home/dunossauro/git/fastapi-do-zero/codigo_das_aulas/10
configfile:<span class="w"> </span>pyproject.toml
plugins:<span class="w"> </span>anyio-4.4.0,<span class="w"> </span>cov-5.0.0,<span class="w"> </span>Faker-25.4.0
collected<span class="w"> </span><span class="m">28</span><span class="w"> </span>items

tests/test_app.py::test_root_deve_retornar_ok_e_ola_mundo<span class="w"> </span>PASSED
tests/test_auth.py::test_get_token<span class="w"> </span>PASSED
tests/test_auth.py::test_token_expired_after_time<span class="w"> </span>PASSED
tests/test_auth.py::test_token_inexistent_user<span class="w"> </span>PASSED
tests/test_auth.py::test_token_wrong_password<span class="w"> </span>PASSED
tests/test_auth.py::test_refresh_token<span class="w"> </span>PASSED
tests/test_auth.py::test_token_expired_dont_refresh<span class="w"> </span>PASSED
tests/test_db.py::test_create_user<span class="w"> </span>PASSED
tests/test_db.py::test_create_todo<span class="w"> </span>PASSED
tests/test_security.py::test_jwt<span class="w"> </span>PASSED
tests/test_todos.py::test_create_todo<span class="w"> </span>PASSED
tests/test_todos.py::test_list_todos_should_return_5_todos<span class="w"> </span>PASSED
tests/test_todos.py::test_list_todos_pagination_should_return_2_todos<span class="w"> </span>PASSED
tests/test_todos.py::test_list_todos_filter_title_should_return_5_todos<span class="w"> </span>PASSED
tests/test_todos.py::test_list_todos_filter_description_should_return_5_todos<span class="w"> </span>PASSED
tests/test_todos.py::test_list_todos_filter_state_should_return_5_todos<span class="w"> </span>PASSED
tests/test_todos.py::test_list_todos_filter_combined_should_return_5_todos<span class="w"> </span>PASSED
tests/test_todos.py::test_patch_todo_error<span class="w"> </span>PASSED
tests/test_todos.py::test_patch_todo<span class="w"> </span>PASSED
tests/test_todos.py::test_delete_todo<span class="w"> </span>PASSED
tests/test_todos.py::test_delete_todo_error<span class="w"> </span>PASSED
tests/test_users.py::test_create_user<span class="w"> </span>PASSED
tests/test_users.py::test_read_users<span class="w"> </span>PASSED
tests/test_users.py::test_read_users_with_users<span class="w"> </span>PASSED
tests/test_users.py::test_update_user<span class="w"> </span>PASSED
tests/test_users.py::test_delete_user<span class="w"> </span>PASSED
tests/test_users.py::test_update_user_with_wrong_user<span class="w"> </span>PASSED
tests/test_users.py::test_delete_user_wrong_user<span class="w"> </span>PASSED

----------<span class="w"> </span>coverage:<span class="w"> </span>platform<span class="w"> </span>linux,<span class="w"> </span>python<span class="w"> </span><span class="m">3</span>.12.3-final-0<span class="w"> </span>-----------
Name<span class="w">                         </span>Stmts<span class="w">   </span>Miss<span class="w">  </span>Cover
------------------------------------------------
fast_zero/__init__.py<span class="w">            </span><span class="m">0</span><span class="w">      </span><span class="m">0</span><span class="w">   </span><span class="m">100</span>%
fast_zero/app.py<span class="w">                </span><span class="m">11</span><span class="w">      </span><span class="m">0</span><span class="w">   </span><span class="m">100</span>%
fast_zero/database.py<span class="w">            </span><span class="m">7</span><span class="w">      </span><span class="m">2</span><span class="w">    </span><span class="m">71</span>%
fast_zero/models.py<span class="w">             </span><span class="m">29</span><span class="w">      </span><span class="m">0</span><span class="w">   </span><span class="m">100</span>%
fast_zero/routers/auth.py<span class="w">       </span><span class="m">26</span><span class="w">      </span><span class="m">0</span><span class="w">   </span><span class="m">100</span>%
fast_zero/routers/todos.py<span class="w">      </span><span class="m">50</span><span class="w">      </span><span class="m">0</span><span class="w">   </span><span class="m">100</span>%
fast_zero/routers/users.py<span class="w">      </span><span class="m">47</span><span class="w">      </span><span class="m">4</span><span class="w">    </span><span class="m">91</span>%
fast_zero/schemas.py<span class="w">            </span><span class="m">35</span><span class="w">      </span><span class="m">0</span><span class="w">   </span><span class="m">100</span>%
fast_zero/security.py<span class="w">           </span><span class="m">42</span><span class="w">      </span><span class="m">3</span><span class="w">    </span><span class="m">93</span>%
fast_zero/settings.py<span class="w">            </span><span class="m">7</span><span class="w">      </span><span class="m">0</span><span class="w">   </span><span class="m">100</span>%
------------------------------------------------
TOTAL<span class="w">                          </span><span class="m">254</span><span class="w">      </span><span class="m">9</span><span class="w">    </span><span class="m">96</span>%


<span class="o">==========</span><span class="w"> </span><span class="m">28</span><span class="w"> </span>passed<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">4</span>.94s<span class="w"> </span><span class="o">==========</span>
Wrote<span class="w"> </span>HTML<span class="w"> </span>report<span class="w"> </span>to<span class="w"> </span>htmlcov/index.html
</code></pre></div>
<p>Embora essa seja uma abordagem que funciona, ela é trabalhosa e temos que garantir que o container sempre esteja de pé. E como garantir isso durante a execução dos testes?</p>
<h3>Containers de testes</h3>
<p>Uma forma de interessante de usar containers em testes, é usar <strong>containers específicos para testes</strong>. Em python temos uma biblioteca chamada <a href="https://testcontainers-python.readthedocs.io/en/latest/">testcontainers</a>{:target="_blank"}.</p>
<p>TestContainers é uma biblioteca que fornece uma interface python para executarmos os containers diretamente no código dos testes. Você importa o código referente a um container e ele te retorna todas as configurações para que você possa usar durante os testes. Desta forma, podemos controlar o fluxo de inicialização/finalização dos containers diretamente no código.</p>
<p>A biblioteca TestContainers tem diversas opções de containers, principalmente de bancos de dados. Como MariaDB, MongoDB, InfluxDB, etc. Também temos a opção de iniciar o PostgreSQL. Para isso, vamos instalar o testcontainters:</p>
<div class="highlight"><span class="filename">$ Execução no terminal!</span><pre><span></span><code>poetry<span class="w"> </span>add<span class="w"> </span>--group<span class="w"> </span>dev<span class="w"> </span>testcontainers
</code></pre></div>
<p>Com o <code>testcontainers</code> instalado iremos alterar a fixture de conexão com o banco de dados, para usar um container que será gerenciado pela fixture:</p>
<div class="highlight"><span class="filename">tests/conftest.py</span><pre><span></span><code><span class="kn">from</span> <span class="nn">testcontainers.postgres</span> <span class="kn">import</span> <span class="n">PostgresContainer</span> <span class="c1">#(1)!</span>

<span class="c1"># ...</span>

<span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">session</span><span class="p">():</span>
<span class="hll">    <span class="k">with</span> <span class="n">PostgresContainer</span><span class="p">(</span><span class="s1">'postgres:16'</span><span class="p">,</span> <span class="n">driver</span><span class="o">=</span><span class="s1">'psycopg'</span><span class="p">)</span> <span class="k">as</span> <span class="n">postgres</span><span class="p">:</span> <span class="c1">#(2)!</span>
</span><span class="hll">        <span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="n">postgres</span><span class="o">.</span><span class="n">get_connection_url</span><span class="p">())</span> <span class="c1">#(3)!</span>
</span>        <span class="n">table_registry</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">create_all</span><span class="p">(</span><span class="n">engine</span><span class="p">)</span>

        <span class="k">with</span> <span class="n">Session</span><span class="p">(</span><span class="n">engine</span><span class="p">)</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">session</span>
            <span class="n">session</span><span class="o">.</span><span class="n">rollback</span><span class="p">()</span>

        <span class="n">table_registry</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">drop_all</span><span class="p">(</span><span class="n">engine</span><span class="p">)</span>
</code></pre></div>
<ol>
<li>Faz o import do <code>PostgresContainer</code> dos testcontainers. O que quer dizer que ela será iniciada somente uma vez durante toda a sessão de testes.</li>
<li>Cria um container de postgres na versão 16. Usando o <code>psycopg</code> como driver.</li>
<li><code>get_connection_url()</code> pega a URI do container postgres criado pelo <code>testcontainers</code>.</li>
</ol>
<p>Agora, todas às vezes em que a fixture de <code>session</code> for usada nos testes. Será iniciado um novo container postgres na versão 16. E as interações com o banco serão feitas nesse container.</p>
<p>Tudo pronto para execução dos testes:</p>
<div class="highlight"><span class="filename">$ Execução no terminal!</span><pre><span></span><code>task<span class="w"> </span><span class="nb">test</span>
</code></pre></div>
<p>Os testes devem ser executados com sucesso, mas algumas mensagens estranhas podem começar a aparecer entre o nome dos testes. Algo como:</p>
<div class="highlight"><span class="filename">$ Parte da resposta do comando de testes</span><pre><span></span><code>tests/test_users.py::test_delete_user_wrong_user<span class="w"> </span>Pulling<span class="w"> </span>image<span class="w"> </span>postgres:16
<span class="hll">Container<span class="w"> </span>started:<span class="w"> </span>beff0853dde0
</span><span class="hll">Waiting<span class="w"> </span><span class="k">for</span><span class="w"> </span>container<span class="w"> </span>&lt;Container:<span class="w"> </span>beff0853dde0&gt;<span class="w"> </span>with<span class="w"> </span>image<span class="w"> </span>postgres:16<span class="w"> </span>to<span class="w"> </span>be<span class="w"> </span>ready<span class="w"> </span>...
</span><span class="hll">Waiting<span class="w"> </span><span class="k">for</span><span class="w"> </span>container<span class="w"> </span>&lt;Container:<span class="w"> </span>beff0853dde0&gt;<span class="w"> </span>with<span class="w"> </span>image<span class="w"> </span>postgres:16<span class="w"> </span>to<span class="w"> </span>be<span class="w"> </span>ready<span class="w"> </span>...
</span>PASSED
<span class="c1"># ...</span>
<span class="o">=========</span><span class="w"> </span><span class="o">{</span>++28<span class="w"> </span>passed<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">80</span>.92s<span class="w"> </span><span class="o">(</span><span class="m">0</span>:01:20<span class="o">)</span>++<span class="o">}</span><span class="w"> </span><span class="o">=========</span>
</code></pre></div>
<p>A mensagem <code>Pulling image postgres:16</code> está dizendo que o container do postgres está sendo baixado do hub. Logo em seguida temos a mensagem <code>Container started: beff0853dde0</code>. Que diz que o container com id <code>beff0853dde0</code> foi iniciado. Após essa mensagem vemos o <code>Waiting for container</code>, que diz que está aguardando o container estar pronto para operar durante os testes.</p>
<p>Uma coisa <em>preocupante</em> nessa execução é a mensagem final: <code>28 passed in 80.92s (0:01:20)</code>. Embora todos os testes tenham sido executados com sucesso, levaram 80 segundos para serem executados (isso na minha máquina).</p>
<p>Isso faz com que o tempo de feedback dos testes seja alto. Quando isso acontece, tendemos a executar menos os testes, por conta da demora. Então, temos que melhorar esse tempo.</p>
<h4>Fixtures de sessão</h4>
<p>As fixtures do pytest, por padrão, são executadas todas às vezes em que uma função de teste recebe a fixture como argumento:</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">código de exemplo</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">fixture_de_exemplo</span><span class="p">():</span>
    <span class="c1"># arrange</span>
<span class="hll">    <span class="k">yield</span>
</span>    <span class="c1"># teardown</span>

<span class="hll"><span class="k">def</span> <span class="nf">teste_de_exemplo</span><span class="p">(</span><span class="n">fixture_de_exemplo</span><span class="p">):</span> <span class="o">...</span>
</span></code></pre></div></td></tr></table></div>
<p>Antes de executar o <code>teste_de_exemplo</code>, será executado o código da fixture até a instrução <code>#!python yield</code> ser executada. A preparação para o teste (arrange). Quando a função de teste é finalizada, o bloco após o yield é executado. Chamamos ele de "teardown", para desfazer o efeito do "arrage". A volta do ambiente como era antes do "arrange".</p>
<p>Dizemos que uma fixture "tradicional" tem o escopo de função. Pois ela é iniciada e finalizada em todas as funções de teste.</p>
<p>Contudo, existem outros <a href="https://docs.pytest.org/en/latest/how-to/fixtures.html#fixture-scopes">escopos</a>{:target="_blank"}, que precisam ser explícitos durante a declaração da fixture, pelo parâmetro <code>scope</code>. Existem diversos escopos:</p>
<ul>
<li><code>function</code>: executada em todas as funções de teste;</li>
<li><code>class</code>: executada uma vez por classe de teste;</li>
<li><code>module</code>: executada uma vez por módulo;</li>
<li><code>package</code>: executada uma vez por pacote;</li>
<li><code>session</code>: executava uma vez por execução dos testes;</li>
</ul>
<p>Para resolver o problema com a lentidão dos testes, iremos criar uma fixture para iniciar o container do banco de dados com o escopo <code>#!python "session"</code>.</p>
<div class="highlight"><pre><span></span><code>sequenceDiagram
    PytestRunner--&gt;&gt;Fixture: Executa a fixture até o yield
    PytestRunner-&gt;&gt;Testes: Executa todos os testes
    Testes--&gt;&gt;Testes: Executa um teste
    PytestRunner--&gt;&gt;Fixture: Executa a fixture depois do yield
</code></pre></div>
<p>Dessa forma, a fixture é inicializada antes de todos os testes, está disponível durante a execução das funções, sendo finalizada após a execução de todos os testes.</p>
<h4>Fixture para engine</h4>
<p>Para resolver o problema da lentidão, vamos criar nova fixture para a <code>engine</code> no escopo <code>session</code>. Ela ficará responsável por iniciar o container (arrange), criar a conexão persistente com o postgres (yield) e desfazer o container após a execução de todos os testes (teardown):</p>
<div class="highlight"><span class="filename">tests/conftest.py</span><pre><span></span><code><span class="hll"><span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span><span class="p">(</span><span class="n">scope</span><span class="o">=</span><span class="s1">'session'</span><span class="p">)</span><span class="c1">#(1)!</span>
</span><span class="k">def</span> <span class="nf">engine</span><span class="p">():</span>
    <span class="k">with</span> <span class="n">PostgresContainer</span><span class="p">(</span><span class="s1">'postgres:16'</span><span class="p">,</span> <span class="n">driver</span><span class="o">=</span><span class="s1">'psycopg'</span><span class="p">)</span> <span class="k">as</span> <span class="n">postgres</span><span class="p">:</span>

        <span class="n">_engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="n">postgres</span><span class="o">.</span><span class="n">get_connection_url</span><span class="p">())</span>

<span class="hll">        <span class="k">with</span> <span class="n">_engine</span><span class="o">.</span><span class="n">begin</span><span class="p">():</span><span class="c1">#(2)!</span>
</span>            <span class="k">yield</span> <span class="n">_engine</span>
</code></pre></div>
<ol>
<li>fixture sendo definida com o escopo <code>#!python 'session'</code>.</li>
<li>Inicia a conexão com o banco de dados. A <code>Session</code> originalmente inicia a conexão e a fecha. Contudo, como vamos criar diversas sessions, é interessante que o controle da conexão seja gerenciado pela engine.</li>
</ol>
<p>Desta forma, por consequência, não iremos mais definir a engine na fixture de <code>session</code>. Usaremos a fixture de engine, que será criada somente uma vez durante toda a execução dos testes:</p>
<div class="highlight"><span class="filename">tests/conftest.py</span><pre><span></span><code><span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span><span class="p">()</span>
<span class="hll"><span class="k">def</span> <span class="nf">session</span><span class="p">(</span><span class="n">engine</span><span class="p">):</span><span class="c1">#(1)!</span>
</span>    <span class="n">table_registry</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">create_all</span><span class="p">(</span><span class="n">engine</span><span class="p">)</span>

    <span class="k">with</span> <span class="n">Session</span><span class="p">(</span><span class="n">engine</span><span class="p">)</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
        <span class="k">yield</span> <span class="n">session</span>
        <span class="n">session</span><span class="o">.</span><span class="n">rollback</span><span class="p">()</span>

    <span class="n">table_registry</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">drop_all</span><span class="p">(</span><span class="n">engine</span><span class="p">)</span>
</code></pre></div>
<ol>
<li><code>engine</code> agora é definida pela fixture de <code>engine</code>.</li>
</ol>
<p>Com isso, podemos executar os testes novamente e devemos ver uma diferença significativa de tempo:</p>
<div class="no-copy highlight"><span class="filename">$ Execução no terminal!</span><pre><span></span><code>task<span class="w"> </span><span class="nb">test</span>

<span class="c1"># ...</span>
<span class="o">=========</span><span class="w"> </span><span class="m">28</span><span class="w"> </span>passed<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">7</span>.96s<span class="w"> </span><span class="o">=========</span>
</code></pre></div>
<p>Com o container sendo iniciado somente uma vez, o tempo total de execução dos testes caiu para <code>7.96s</code>, em comparação com os 80 segundos que tínhamos antes. Um tempo de feedback aceitável para execução de testes.</p>
<hr>
<p>Desta forma temos uma separação do nosso container postgres de desenvolvimento, do container usado pelos testes. Fazendo com que a execução dos testes não remova os dados inseridos durante o desenvolvimento da aplicação.</p>
<h2>Commit</h2>
<p>Para finalizar, após criar nosso arquivo <code>Dockerfile</code> e <code>compose.yaml</code>, executar os testes e construir nosso ambiente, podemos fazer o commit das alterações no Git:</p>
<ol>
<li>Adicionando todos os arquivos modificados nessa aula com <code>git add .</code></li>
<li>Faça o commit das alterações com <code>git commit -m "Dockerizando nossa aplicação e inserindo o PostgreSQL"</code></li>
<li>Envie as alterações para o repositório remoto com <code>git push</code></li>
</ol>
<h2>Conclusão</h2>
<p>Dockerizar nossa aplicação FastAPI, com o PostgreSQL, nos permite garantir consistência em diferentes ambientes. A combinação de Docker e Docker Compose simplifica o processo de desenvolvimento e implantação. Na próxima aula, aprenderemos como levar nossa aplicação para o próximo nível executando os testes de forma remota com a integração contínua do GitHub Actions.</p>
<hr>
<p>Agora que a aula acabou, é um bom momento para você relembrar alguns conceitos e fixar melhor o conteúdo respondendo ao questionário referente a ela.</p>
<p><a href="quizes/aula_10.md">Quiz :material-comment-question:</a>{ .md-button }</p></div><style type="text/css">.quiz {
  border: 1px solid black;
  padding: 1rem;
  margin: 1rem 0;
}
/* Set margin-top of first quiz child */
.quiz > *:first-child {
  margin-top: 0;
}
.hidden {
  display: none;
}

form button {
  background-color: var(--md-primary-fg-color);
  border: none;
  color: var(--md-primary-bg-color);
  padding: 0.5rem 1rem;
  text-align: center;
  text-decoration: none;
  display: inline-block;
  font-size: 0.8rem;
}

.wrong label {
  color: red;
}
.correct label {
  color: green;
}

fieldset {
  border: none;
  display: flex;
  flex-direction: column;
}
fieldset input {
  margin: 0 10px;
}
fieldset label {
  margin: 0 10px;
}

label.correct {
  color: green;
}
label.wrong {
  color: red;
}
input[type='radio'].correct {
  accent-color: green;
}
input[type='radio'].wrong {
  accent-color: red;
}
.content {
  margin: 10px;
}
</style><script type="text/javascript" defer>document.querySelectorAll('.quiz').forEach((quiz) => {
  let form = quiz.querySelector('form');
  let fieldset = form.querySelector('fieldset');
  form.addEventListener('submit', (event) => {
    event.preventDefault();
    let selectedAnswers = form.querySelectorAll('input[name="answer"]:checked');
    let correctAnswers = fieldset.querySelectorAll(
      'input[name="answer"][correct]'
    );
    // Check if all correct answers are selected
    let is_correct = selectedAnswers.length === correctAnswers.length;
    for (let i = 0; i < selectedAnswers.length; i++) {
      if (!selectedAnswers[i].hasAttribute('correct')) {
        is_correct = false;
        break;
      }
    }
    let section = quiz.querySelector('section');
    if (is_correct) {
      section.classList.remove('hidden');
      resetFieldset(fieldset);
      // Mark all fields with colors
      const allAnswers = fieldset.querySelectorAll('input[name="answer"]');
      for (let i = 0; i < allAnswers.length; i++) {
        if (allAnswers[i].hasAttribute('correct')) {
          allAnswers[i].parentElement.classList.add('correct');
        } else {
          allAnswers[i].parentElement.classList.add('wrong');
        }
      }
    } else {
      section.classList.add('hidden');
      resetFieldset(fieldset);
      // Mark wrong fields with colors
      for (let i = 0; i < selectedAnswers.length; i++) {
        if (!selectedAnswers[i].hasAttribute('correct')) {
          selectedAnswers[i].parentElement.classList.add('wrong');
        } else {
          selectedAnswers[i].parentElement.classList.add('correct');
        }
      }
    }
  });
});

function resetFieldset(fieldset) {
  const fieldsetChildren = fieldset.children;
  for (let i = 0; i < fieldsetChildren.length; i++) {
    fieldsetChildren[i].classList.remove('wrong');
    fieldsetChildren[i].classList.remove('correct');
  }
}
</script>







  
    
  
  


  <aside class="md-source-file">
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="Última atualização">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1-2.1-2M12.5 7v5.2l4 2.4-1 1L11 13V7h1.5M11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2v1.8Z"/></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">June 6, 2024</span>
  </span>

    
    
    
      
  
  <span class="md-source-file__fact">
    <span class="md-icon" title="Contribuidores">
      
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 5.5A3.5 3.5 0 0 1 15.5 9a3.5 3.5 0 0 1-3.5 3.5A3.5 3.5 0 0 1 8.5 9 3.5 3.5 0 0 1 12 5.5M5 8c.56 0 1.08.15 1.53.42-.15 1.43.27 2.85 1.13 3.96C7.16 13.34 6.16 14 5 14a3 3 0 0 1-3-3 3 3 0 0 1 3-3m14 0a3 3 0 0 1 3 3 3 3 0 0 1-3 3c-1.16 0-2.16-.66-2.66-1.62a5.536 5.536 0 0 0 1.13-3.96c.45-.27.97-.42 1.53-.42M5.5 18.25c0-2.07 2.91-3.75 6.5-3.75s6.5 1.68 6.5 3.75V20h-13v-1.75M0 20v-1.5c0-1.39 1.89-2.56 4.45-2.9-.59.68-.95 1.62-.95 2.65V20H0m24 0h-3.5v-1.75c0-1.03-.36-1.97-.95-2.65 2.56.34 4.45 1.51 4.45 2.9V20Z"/></svg>
      
    </span>
    <nav>
      dunossauro, Lucas Mendes
    </nav>
  </span>

    
    
  </aside>





                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var tab,labels=set.querySelector(".tabbed-labels");for(tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/dunossauro" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://twitter.com/dunossauro" target="_blank" rel="noopener" title="twitter.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://youtube.com/dunossauro" target="_blank" rel="noopener" title="youtube.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M549.655 124.083c-6.281-23.65-24.787-42.276-48.284-48.597C458.781 64 288 64 288 64S117.22 64 74.629 75.486c-23.497 6.322-42.003 24.947-48.284 48.597-11.412 42.867-11.412 132.305-11.412 132.305s0 89.438 11.412 132.305c6.281 23.65 24.787 41.5 48.284 47.821C117.22 448 288 448 288 448s170.78 0 213.371-11.486c23.497-6.321 42.003-24.171 48.284-47.821 11.412-42.867 11.412-132.305 11.412-132.305s0-89.438-11.412-132.305zm-317.51 213.508V175.185l142.739 81.205-142.739 81.201z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://instagram.com/dunossauro" target="_blank" rel="noopener" title="instagram.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M224.1 141c-63.6 0-114.9 51.3-114.9 114.9s51.3 114.9 114.9 114.9S339 319.5 339 255.9 287.7 141 224.1 141zm0 189.6c-41.1 0-74.7-33.5-74.7-74.7s33.5-74.7 74.7-74.7 74.7 33.5 74.7 74.7-33.6 74.7-74.7 74.7zm146.4-194.3c0 14.9-12 26.8-26.8 26.8-14.9 0-26.8-12-26.8-26.8s12-26.8 26.8-26.8 26.8 12 26.8 26.8zm76.1 27.2c-1.7-35.9-9.9-67.7-36.2-93.9-26.2-26.2-58-34.4-93.9-36.2-37-2.1-147.9-2.1-184.9 0-35.8 1.7-67.6 9.9-93.9 36.1s-34.4 58-36.2 93.9c-2.1 37-2.1 147.9 0 184.9 1.7 35.9 9.9 67.7 36.2 93.9s58 34.4 93.9 36.2c37 2.1 147.9 2.1 184.9 0 35.9-1.7 67.7-9.9 93.9-36.2 26.2-26.2 34.4-58 36.2-93.9 2.1-37 2.1-147.8 0-184.8zM398.8 388c-7.8 19.6-22.9 34.7-42.6 42.6-29.5 11.7-99.5 9-132.1 9s-102.7 2.6-132.1-9c-19.6-7.8-34.7-22.9-42.6-42.6-11.7-29.5-9-99.5-9-132.1s-2.6-102.7 9-132.1c7.8-19.6 22.9-34.7 42.6-42.6 29.5-11.7 99.5-9 132.1-9s102.7-2.6 132.1 9c19.6 7.8 34.7 22.9 42.6 42.6 11.7 29.5 9 99.5 9 132.1s2.7 102.7-9 132.1z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://www.tiktok.com/@dunossauro" target="_blank" rel="noopener" title="www.tiktok.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M448 209.91a210.06 210.06 0 0 1-122.77-39.25v178.72A162.55 162.55 0 1 1 185 188.31v89.89a74.62 74.62 0 1 0 52.23 71.18V0h88a121.18 121.18 0 0 0 1.86 22.17A122.18 122.18 0 0 0 381 102.39a121.43 121.43 0 0 0 67 20.14Z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": ["content.code.annotate", "content.code.copy", "content.tabs.link", "search.suggest", "search.highlight", "search.share"], "search": "../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copiado para \u00e1rea de transfer\u00eancia", "clipboard.copy": "Copiar para \u00e1rea de transfer\u00eancia", "search.result.more.one": "mais 1 nesta p\u00e1gina", "search.result.more.other": "# mais nesta p\u00e1gina", "search.result.none": "Nenhum documento encontrado", "search.result.one": "1 documento encontrado", "search.result.other": "# documentos encontrados", "search.result.placeholder": "Digite para iniciar a busca", "search.result.term.missing": "Ausente", "select.version": "Selecione a vers\u00e3o"}}</script>
    
    
      <script src="../assets/javascripts/bundle.ad660dcc.min.js"></script>
      
    
  <script id="init-glightbox">const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
document$.subscribe(() => { lightbox.reload() });
</script></body>
</html>